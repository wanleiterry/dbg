<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8"/>
<title>后台管理系统</title>
<meta name="author" content="DeathGhost" />
<link rel="stylesheet" type="text/css" href="/css/bootstrap.min.css">
<link rel="stylesheet" type="text/css" href="/css/bootstrap-theme.min.css">
<link rel="stylesheet" type="text/css" href="/admin/css/common.css" />
</head>
<body>
<div id="header"></div>
<div class="main clearfix container">
  	<div id="left"></div>
  	<div class="rt_wrap content mCustomScrollbar">
		<p>
			<button type="button" class="btn btn-danger" class="addnews" data-toggle="modal"  data-target=".createnews">
				<span class='glyphicon glyphicon-plus'></span>增加资讯
			</button>
		</p>
	  	<div class="table-responsive">
			<table class="table">
				<tbody>
					<table class="table table-hover goods-list">
				        <thead>
					        <tr>
					            <th style='width:15%'>标题</th>
								<th style='width:45%'>内容</th>
					            <th style='width:25%'>发布时间</a></th>
					            <th style='width:15%'>管理</th>
					        </tr>
				        </thead>
				        <tbody id="goods-list">
					        
				        </tbody>				        
				    </table>
				    <table class="table">
				    	<tbody>
				    		<tr>
				    			<td width="80%">
				    				<div class="pull-left">
				    					共有<span class="total_num"></span>条数据
				    				</div>
				    				<div class="pull-right">
				    					<nav>
		                                    <ul class="pagination">
		                                        <li class="disabled">
		                                            <a href="#" aria-label="Previous">
		                                                <span aria-hidden="true">«</span>
		                                            </a>
		                                        </li>
		                                        <li class="active"><a href="#">1</a></li>
		                                        <li><a href="#">2</a></li>
		                                        <li><a href="#">3</a></li>
		                                        <li><a href="#">4</a></li>
		                                        <li><a href="#">5</a></li>
		                                        <li>
		                                            <a href="#" aria-label="Next">
		                                                <span aria-hidden="true">»</span>
		                                            </a>
		                                        </li>
		                                    </ul>
		                                </nav>
				    				</div>
				    				<div class="clearfix"></div>
				    			</td>
				    		</tr>
				    	</tbody>
				    </table>
				</tbody>
			</table>
		</div>
  	</div>
</div>
<div class="modal fade changenews" tabindex="-1" role="dialog" aria-labelledby="myLargeModalLabel">
	<div class="modal-dialog modal-lg">
		<div class="modal-content">
			<div class="modal-header">
				<button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
				<h4>咨询展示</h4>
			</div>
			<form class="form-horizontal" enctype="multipart/form-data" id="editForm" method="post" action="">
				<span class="change_news_id" style='display: none'></span>
				<div class="form-group">
					<label class="col-sm-2 control-label">标题</label>
					<div class="col-sm-10">
						<input type="email" class="form-control" id="editname" placeholder="Email" name='title'>
					</div>
				</div>
				<div class="form-group">
					<label class="col-sm-2 control-label">内容</label>
					<div class="col-sm-10">
						<textarea class="form-control" id='editdesc' name='desc'>
							
						</textarea>
					</div>
				</div>
				<div class="form-group">
					<label for="inputPassword3" class="col-sm-2 control-label">图片</label>
					<div class="col-sm-10">
						 <input type="file" id="myFile" name="myFile">
					</div>
				</div>
				<div class="form-group">
					<div class="col-sm-offset-2 col-sm-10">
						<ul class="list-inline">
							<li>				      				
								<button type="button" class="btn btn-default" id="ok">保存</button>
							</li>
							<li>				      				
								<button type="button" class="btn btn-default">取消</button>
							</li>
						</ul>
					</div>
				</div>
			</form>
		</div>
	</div>
</div>
<div class="modal fade createnews" tabindex="-1" role="dialog" aria-labelledby="myLargeModalLabel">
	<div class="modal-dialog modal-lg">
		<div class="modal-content">
			<div class="modal-header">
				<button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
				<h4>案例展示</h4>
			</div>
			<form class="form-horizontal" enctype="multipart/form-data" id="addForm" method="post" action="">
				<div class="form-group">
					<label class="col-sm-2 control-label">标题</label>
					<div class="col-sm-10">
						<input type="text" class="form-control" id="title" placeholder="标题" name='title'>
					</div>
				</div>
				<div class="form-group">
					<label class="col-sm-2 control-label">内容</label>
					<div class="col-sm-10">
						<textarea class="form-control" id='content' name='content'>
							
						</textarea>
					</div>
				</div>
				<div class="form-group">
					<label class="col-sm-2 control-label">图片</label>
					<div class="col-sm-10">
						 <input type="file" id="uploadimg" name="myFile">
					</div>
				</div>
				<div class="form-group">
					<div class="col-sm-offset-2 col-sm-10">
						<ul class="list-inline">
							<li>				      				
								<button type="button" class="btn btn-default" id="create">保存</button>
							</li>
							<li>				      				
								<button type="button" class="btn btn-default" id='quxiao'>取消</button>
							</li>
						</ul>
					</div>
				</div>
			</form>
		</div>
	</div>
</div>
</body>
<script type="text/javascript" src="/js/jquery-1.8.0.min.js"></script>
<script type="text/javascript" src="/js/bootstrap.min.js"></script>
<script type="text/javascript">$("#header").load("/admin/header.html");</script>
<script type="text/javascript">$("#left").load("/admin/left.html");</script>
<script>	
	function deletenews(id){
		if(window.confirm('你确定要删除选中的产品吗？')){
			//alert("确定");
			$.ajax({
				url: '/admin/news/'+id+'.json',
				type:"delete",
				dataType:"json",
				data:'',
				success:function(data){
					console.log(data);
					loadlist();
				}
			});
		}
		else{
			return false;
		}	
	}
	function edit(id) {
		$.ajax({
            url:'/news/'+id+'.json',
            type: "get",
            dataType: "json",
            data: '',
            success: function(data){
                console.log(data);
                $('.change_news_id').html(''+id+'');
                loadlist();
            }
        })
	}
	function loadlist(){
		$.ajax({
			url:'/news/list.json',
			type: "get",
			dataType: "json",
			data: '',
			success: function(data){
				var json=data.data;
				var str='';
				for(var i=0;i<json.length;i++){
					str+='<tr><td><p>'+json[i].title+'</p></td>';
					str+='<td>'+json[i].desc+'</td>';
					str+='<td>2016-04-06 11:16:45</td>';
					str+='<td><p><a class="editnews" onclick="edit('+json[i].id+')" data-toggle="modal"  data-target=".changenews">编辑</a>';
					str+='<span>|</span><a class="deletenews" onclick="deletenews('+json[i].id+')">删除</a></p></td></tr>';
				}
				$('#goods-list').html(str);
			}
		});
	}
	$(function(){	
		loadlist();
		$('#ok').click(function(){
			var id=$('.change_news_id').html();
			$("#editForm").attr('action', '/admin/news/'+id+'.json').submit();
			/*$.ajax({
				url: '/admin/news/'+id+'.json',
				type:"put",
				dataType:"json",
				data:'',
				success:function(data){
					console.log(data);
				}
			});*/
		});
		$('#quxiao').click(function(){			
			$('.close').click()
		})
		$('#create').click(function(){
			$('#addForm').attr('action', '/admin/news/create.json').submit();
			/*var param = {
				'name':$('#title').val(),
				'content':$('#content').val(),
				'pic':$('#img').val(),
				'desc':$('#content').val()
			}
			$.ajax({
				url: '/admin/news/create.json',
				type:"post",
				dataType:"json",
				data:param,
				success:function(data){
					console.log(data);
					if(data.status==true){
						$('.close').click();
						loadlist();
					}
					else{
						alert('创建失败');
					}
				}
			});*/
		})
	})
</script>
</html>
