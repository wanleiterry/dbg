<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8"/>
<title>后台管理系统</title>
<link rel="stylesheet" type="text/css" href="/css/bootstrap.min.css">
<link rel="stylesheet" type="text/css" href="/css/bootstrap-theme.min.css">
<link rel="stylesheet" type="text/css" href="/admin/css/common.css" />
</head>
<body>
<div id="header"></div>
<div class="main clearfix container">
  	<div id="left"></div>
  	<div class="rt_wrap content mCustomScrollbar">
		<p>
			<button type="button" class="btn btn-danger" class="addproduct" data-toggle="modal"  data-target=".creategoods">
				<span class='glyphicon glyphicon-plus'></span>增加案例
			</button>
		</p>
  		<div class="table-responsive">
			<table class="table">
				<tbody>
					<table class="table table-hover goods-list">
				        <thead>
					        <tr>
					            <th style='width:10%'></th>
					            <th style='width:15%'>商品</th>
					            <th style='width:30%'>描述</th>
					            <th style='width:15%'>分类</th>
					            <th style='width:20%'><a>发布时间</a></th>
					            <th style='width:10%'>管理</th>
					        </tr>
				        </thead>
				        <tbody id="goods-list"></tbody>				        
				    </table>
				    <table class="table">
				    	<tbody>
				    		<tr>
				    			<td>
				    				<div class="pull-left">
				    					共有<span class="total_num"></span>条数据
				    				</div>
				    				<div class="pull-right" id='pagination'>
				    					<nav>
		                                    <ul class="pagination">
		                                        <li class="disabled">
		                                            <a href="#" aria-label="Previous">
		                                                <span aria-hidden="true">«</span>
		                                            </a>
		                                        </li>
		                                        <li class="active"><a href="#">1</a></li>
		                                        <li><a href="#">2</a></li>
		                                        <li><a href="#">3</a></li>
		                                        <li><a href="#">4</a></li>
		                                        <li><a href="#">5</a></li>
		                                        <li>
		                                            <a href="#" aria-label="Next">
		                                                <span aria-hidden="true">»</span>
		                                            </a>
		                                        </li>
		                                    </ul>
		                                </nav>
				    				</div>
				    				<div class="clearfix"></div>
				    			</td>
				    		</tr>
				    	</tbody>
				    </table>
				</tbody>
			</table>
		</div>
  	</div>
  	<div class="modal fade changegoods" tabindex="-1" role="dialog" aria-labelledby="myLargeModalLabel">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
	        	<div class="modal-header">
	        		<button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
	        		<h4>案例展示</h4>
	      		</div>
            	<form class="form-horizontal" enctype="multipart/form-data" id="editForm" method="post" action="">
            		<span class="change_product_id" style='display: none'></span>
				  	<div class="form-group">
				    	<label for="inputEmail3" class="col-sm-2 control-label">标题</label>
				    	<div class="col-sm-10">
				      		<input type="text" class="form-control" id="title" placeholder="标题" name='title'>
				    	</div>
				  	</div>
				  	<div class="form-group" id='edit_select'>
				    	<label class="col-sm-2 control-label">分类</label>
				    	<div class="col-sm-10">
				      		<select class="form-control" name='category_id'></select>
				    	</div>
				  	</div>
				  	<div class="form-group">
				    	<label class="col-sm-2 control-label">内容</label>
				    	<div class="col-sm-10">
				      		<textarea class="form-control" id='content' name='content'>
				      			
				      		</textarea>
				    	</div>
				  	</div>
				  	<div class="form-group">
				    	<label class="col-sm-2 control-label">图片</label>
				    	<div class="col-sm-10">
				    		 <input type="file" id="exampleInputFile" name='myFile'>
				    	</div>
				  	</div>
				  	<div class="form-group">
				    	<div class="col-sm-offset-2 col-sm-10">
				      		<ul class="list-inline">
				      			<li>				      				
				      				<button type="button" class="btn btn-default" id="ok">保存</button>
				      			</li>
				      			<li>				      				
				      				<button type="button" class="btn btn-default" id='cancel'>取消</button>
				      			</li>
				      		</ul>
				    	</div>
				  	</div>
				</form>
            </div>
        </div>
    </div>
	<div class="modal fade creategoods" tabindex="-1" role="dialog" aria-labelledby="myLargeModalLabel">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
	        	<div class="modal-header">
	        		<button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
	        		<h4>案例展示</h4>
	      		</div>
            	<form class="form-horizontal" enctype="multipart/form-data" id="addForm" method="post" action="">
            		<span class="change_product_id" style='display: none'></span>
				  	<div class="form-group">
				    	<label for="inputEmail3" class="col-sm-2 control-label">标题</label>
				    	<div class="col-sm-10">
				      		<input type="text" class="form-control" id="add_title" placeholder="标题" name='title'>
				    	</div>
				  	</div>
				  	<div class="form-group" id='add_select'>
				    	<label for="inputPassword3" class="col-sm-2 control-label">分类</label>
				    	<div class="col-sm-10">
				      		<select class="form-control" name='category_id'></select>
				    	</div>
				  	</div>
				  	<div class="form-group">
				    	<label for="inputPassword3" class="col-sm-2 control-label">内容</label>
				    	<div class="col-sm-10">
				      		<textarea class="form-control" id='add_content' name='content'>
				      			
				      		</textarea>
				    	</div>
				  	</div>
				  	<div class="form-group">
				    	<label for="inputPassword3" class="col-sm-2 control-label">图片</label>
				    	<div class="col-sm-10">
				    		 <input type="file" id="uploadimg" name='myFile'>
				    	</div>
				  	</div>
				  	<div class="form-group">
				    	<div class="col-sm-offset-2 col-sm-10">
				      		<ul class="list-inline">
				      			<li>				      				
				      				<button type="button" class="btn btn-default" id="create">保存</button>
				      			</li>
				      			<li>				      				
				      				<button type="button" class="btn btn-default" id="quxiao">取消</button>
				      			</li>
				      		</ul>
				    	</div>
				  	</div>
				</form>
            </div>
        </div>
    </div>
</div>
</body>
<script type="text/javascript" src="/js/jquery-1.8.0.min.js"></script>
<script type="text/javascript" src="/js/bootstrap.min.js"></script>
<script type="text/javascript">$("#header").load("/admin/header.html");</script>
<script type="text/javascript">$("#left").load("/admin/left.html");</script>
<script>
	var $rows='';
	function loadcase(){
		$.ajax({
			url:'/cate/list.json',
			type: "get",
			dataType: "json",
			data: '',
			success: function(data){
				var json=data.data;
				var str='';
				for(var i=0;i<json.length;i++){
					str+='<option value="'+json[i].id+'">'+json[i].name+'</option>';
				}
				$('#edit_select select').html(str);
				$('#add_select select').html(str);
			}
		})
	}
	function loadlist(pagenum){
		if(pagenum==undefined){
			pagenum=0;
		}
		$.ajax({
			url:'/case/list.json?limit=10&offset='+pagenum+'',
			type: "get",
			dataType: "json",
			data: '',
			success: function(data){
				$('.total_num').html(''+data._count+'');
				$rows=Math.ceil(parseInt(data._count)/10);
				var _page='';
				if($rows==1){
					$("#pagination").hide();
				}
				else{
					_page+='<nav><ul class="pagination">';
					_page+='<li class="disabled"><a href="#" aria-label="Previous" onclick="gopages(1)"><span aria-hidden="true">&laquo;</span></a></li>';
					for(var i=1;i<$rows+1;i++){
						var activeli=parseInt(pagenum)+1;
						if(i==activeli){
							_page+='<li class="active"><a onclick="gopages(this.text)">'+i+'</a></li>';
						}
						else{
							_page+='<li><a onclick="gopages(this.text)">'+i+'</a></li>';
						}
					}
					_page+='<li><a href="#" aria-label="Next" onclick="gopages($rows)"><span aria-hidden="true">&raquo;</span></a></li></ul></nav>';
				}
				var json=data.data;
				var str='';
				for(var i=0;i<json.length;i++){
					str+='<tr><td><img class="goods-image" src="'+json[i].pic+'" width="60px" height="60px"></td>';
					str+='<td><p>'+json[i].title+'</p></td>';
					str+='<td><p>'+json[i].content+'</p></td>';
					str+='<td><p>'+json[i].cate_name+'</p></td>'
					str+='<td>'+json[i].updated_at+'</td>';
					str+='<td><p><a onclick="edit('+json[i].id+')" data-toggle="modal"  data-target=".changegoods"> 编辑</a>';
					str+='<span>|</span><a class="delete" onclick="delnews('+json[i].id+')">删除</a></p></td></tr>';
				}
				$('#goods-list').html(str);
				$('#pagination').html(_page);
			}
		});
	}
	function gopages(page){
		var newpage=parseInt(page)-1;
		loadlist(newpage);
	}
	function delnews(id){
		if(window.confirm('你确定要删除选中的产品吗？')){
			//alert("确定");
			$.ajax({
				url: '/admin/case/'+id+'.json',
				type:"delete",
				dataType:"json",
				data:'',
				success:function(data){
					loadlist();
				}
			});
		}
		else{
			return false;
		}	
	}	
	function edit(id) {
		$.ajax({
			url:'/case/'+id+'.json',
			type: "get",
			dataType: "json",
			data: '',
			success: function(data){
				$('.change_product_id').html(''+id+'');
				$('#title').val(''+data.title+'');
				$('#desc').val(''+data.desc+'');
				$('#img').val(''+data.pic+'');
				$('#content').val(''+data.content+'');
			}
		})
	}
	$(function(){
		loadcase();
		loadlist();		
		$('#create').click(function(){
			$('#addForm').attr('action', '/admin/case/create.json').submit();
			/*var param = {
				'title':$('#add_title').val(),
				'pic':$('#add_img').val(),
				'category_id':$('#add_select select option:selected').val(),
				'content':$('#add_content').val()
			}
			$.ajax({
				url: '/admin/case/create.json',
				type:"post",
				dataType:"json",
				data:param,
				success:function(data){
					$('.close').click()
					loadlist();
				}
			});*/
		});
		$("#quxiao").click(function(){
			$(".close").click();
		});
		$('#cancel').click(function(){
			$(".close").click();
		});
		$('#ok').click(function(){
			var id=$('.change_product_id').html();
			$('#editForm').attr('action', '/admin/case/'+id+'.json').submit();
			/*var param = {
				'title':$('#title').val(),
				'pic':$('#img').val(),
				'category_id':$('#edit_select select option:selected').val(),
				'content':$('#content').val()
			}
			$.ajax({
				url: '/admin/case/'+id+'.json',
				type:"put",
				dataType:"json",
				data:param,
				success:function(data){
					if(data.status==true){
						$(".close").click();
						loadlist();
					}
					else{
						alert('修改失败！！');
					}
				}
			});*/
		});
	})
</script>
</html>
