<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8"/>
<title>后台管理系统</title>
<link rel="stylesheet" type="text/css" href="/css/bootstrap.min.css">
<link rel="stylesheet" type="text/css" href="/css/bootstrap-theme.min.css">
<link rel="stylesheet" type="text/css" href="/admin/css/common.css" />
</head>
<body>
<div id="header"></div>
<div class="main clearfix container">
  	<div id="left"></div>
  	<div class="rt_wrap content mCustomScrollbar">
		<p>
			<button type="button" class="btn btn-danger" class="addproduct" data-toggle="modal"  data-target=".creategoods">
				<span class='glyphicon glyphicon-plus'></span>增加产品
			</button>
		</p>
  		<div class="table-responsive">
			<table class="table">
				<tbody>
					<table class="table table-hover goods-list">
				        <thead>
					        <tr>
					            <th style='width:10%'></th>
					            <th style='width:15%'>商品</th>
					            <th style='width:45%'>描述</th>
					            <th style='width:20%'><a>发布时间</a></th>
					            <th style='width:10%'>管理</th>
					        </tr>
				        </thead>
				        <tbody id="goods-list"></tbody>				        
				    </table>
				    <table class="table">
				    	<tbody>
				    		<tr>
				    			<td>
				    				<div class="pull-left">
				    					共有<span class="total_num"></span>条数据
				    				</div>
				    				<div class="pull-right" id='pagination'>
				    				</div>
				    				<div class="clearfix"></div>
				    			</td>
				    		</tr>
				    	</tbody>
				    </table>
				</tbody>
			</table>
		</div>
  	</div>
  	<div class="modal fade changegoods" tabindex="-1" role="dialog" aria-labelledby="myLargeModalLabel">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
	        	<div class="modal-header">
	        		<button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
	        		<h4>产品展示</h4>
	      		</div>
            	<form class="form-horizontal" enctype="multipart/form-data" id="editForm" method="post" action="">
            		<span class="change_product_id" style='display: none'></span>
				  	<div class="form-group">
				    	<label for="inputEmail3" class="col-sm-2 control-label">标题</label>
				    	<div class="col-sm-10">
				      		<input type="text" class="form-control" id="title" name="title" placeholder="标题">
				    	</div>
				  	</div>
				  	<div class="form-group">
				    	<label for="inputPassword3" class="col-sm-2 control-label">关键字</label>
				    	<div class="col-sm-10">
				      		<textarea class="form-control" id='desc' name="desc">
				      			
				      		</textarea>
				    	</div>
				  	</div>
				  	<div class="form-group">
				    	<label for="inputPassword3" class="col-sm-2 control-label">内容</label>
				    	<div class="col-sm-10">
				      		<textarea class="form-control" id='content' name="content">
				      			
				      		</textarea>
				    	</div>
				  	</div>
				  	<div class="form-group">
				    	<label for="inputPassword3" class="col-sm-2 control-label">图片</label>
				    	<div class="col-sm-10">
				    		 <input type="file" id="myFile" name="myFile">
				    	</div>
				  	</div>
				  	<div class="form-group">
				    	<div class="col-sm-offset-2 col-sm-10">
				      		<ul class="list-inline">
				      			<li>				      				
				      				<button type="button" class="btn btn-default" id="ok">保存</button>
				      			</li>
				      			<li>				      				
				      				<button type="button" class="btn btn-default" id='cancel'>取消</button>
				      			</li>
				      		</ul>
				    	</div>
				  	</div>
				</form>
            </div>
        </div>
    </div>
	<div class="modal fade creategoods" tabindex="-1" role="dialog" aria-labelledby="myLargeModalLabel">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
	        	<div class="modal-header">
	        		<button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
	        		<h4>增加产品</h4>
	      		</div>
            	<form class="form-horizontal" enctype="multipart/form-data" id="addForm" method="post" action="">
            		<span class="change_product_id" style='display: none'></span>
				  	<div class="form-group">
				    	<label for="inputEmail3" class="col-sm-2 control-label">标题</label>
				    	<div class="col-sm-10">
				      		<input type="text" class="form-control" id="add_title" placeholder="标题" name="title">
				    	</div>
				  	</div>
				  	<div class="form-group">
				    	<label for="inputPassword3" class="col-sm-2 control-label">关键字</label>
				    	<div class="col-sm-10">
				      		<textarea class="form-control" id='add_desc' name="desc">
				      			
				      		</textarea>
				    	</div>
				  	</div>
				  	<div class="form-group">
				    	<label for="inputPassword3" class="col-sm-2 control-label">内容</label>
				    	<div class="col-sm-10">
				      		<textarea class="form-control" id='add_content' name="content">
				      			
				      		</textarea>
				    	</div>
				  	</div>
				  	<div class="form-group">
				    	<label for="inputPassword3" class="col-sm-2 control-label">图片</label>
				    	<div class="col-sm-10">
				    		 <input  type="file" name="myFile" id="add_img">
				    	</div>
				  	</div>
				  	<div class="form-group">
				    	<div class="col-sm-offset-2 col-sm-10">
				      		<ul class="list-inline">
				      			<li>				      				
				      				<button type="button" class="btn btn-default" id="create">保存</button>
				      			</li>
				      			<li>				      				
				      				<button type="button" class="btn btn-default" id="quxiao">取消</button>
				      			</li>
				      		</ul>
				    	</div>
				  	</div>
				</form>
            </div>
        </div>
    </div>
</div>
</body>
<script type="text/javascript" src="/js/jquery-1.8.0.min.js"></script>
<script type="text/javascript" src="/js/bootstrap.min.js"></script>
<script src="http://www.lanrenzhijia.com/ajaxjs/jquery.page.js"></script>
<script type="text/javascript">$("#header").load("/admin/header.html");</script>
<script type="text/javascript">$("#left").load("/admin/left.html");</script>
<script>
	var $rows='';
	function loadlist(pagenum){
		if(pagenum==undefined){
			pagenum=0;
		}
		$.ajax({
			url:'/product/list.json?limit=10&offset='+pagenum+'',
			type: "get",
			dataType: "json",
			data: '',
			success: function(data){
				$('.total_num').html(''+data._count+'');
				$rows=Math.ceil(parseInt(data._count)/10);
				var _page='';
				if($rows==1){
					$("#pagination").hide();
				}
				else{
					_page+='<nav><ul class="pagination">';
					_page+='<li><a href="#" aria-label="Previous" onclick="gopages(1)"><span aria-hidden="true">&laquo;</span></a></li>';
					for(var i=1;i<$rows+1;i++){
						var activeli=parseInt(pagenum)+1;
						if(i==activeli){
							_page+='<li class="active"><a onclick="gopages(this.text)">'+i+'</a></li>';
						}
						else{
							_page+='<li><a onclick="gopages(this.text)">'+i+'</a></li>';
						}
					}
					_page+='<li><a href="#" aria-label="Next" onclick="gopages($rows)"><span aria-hidden="true">&raquo;</span></a></li></ul></nav>';
				}
				var json=data.data;
				var str='';
				for(var i=0;i<json.length;i++){
					str+='<tr><td><img class="goods-image" src="'+json[i].pic+'" width="60px" height="60px"></td>';
					str+='<td><p>'+json[i].name+'</p></td>';
					str+='<td><p>'+json[i].desc+'</p></td>';
					str+='<td>'+json[i].updated_at+'</td>';
					str+='<td><p><a onclick="edit('+json[i].id+')" data-toggle="modal"  data-target=".changegoods"> 编辑</a>';
					str+='<span>|</span><a class="delete" onclick="delnews('+json[i].id+')">删除</a></p></td></tr>';
				}
				$('#goods-list').html(str);
				$('#pagination').html(_page);
			}
		});
	}
	function gopages(page){
		var newpage=parseInt(page)-1;
		loadlist(newpage);
	}
	function delnews(id){
		if(window.confirm('你确定要删除选中的产品吗？')){
			//alert("确定");
			$.ajax({
				url: '/admin/product/'+id+'.json',
				type:"delete",
				dataType:"json",
				data:'',
				success:function(data){
					console.log(data);
					loadlist();
				}
			});
		}
		else{
			return false;
		}	
	}	
	function edit(id) {
		$.ajax({
			url:'/product/'+id+'.json',
			type: "get",
			dataType: "json",
			data: '',
			success: function(data){
				$('.change_product_id').html(''+id+'');
				$('#title').val(''+data.name+'');
				$('#desc').val(''+data.desc+'');
				$('#img').val(''+data.pic+'');
				$('#content').val(''+data.content+'');
			}
		})
	}
	$(function(){
		loadlist();	
	    $(".tcdPageCode").createPage({
	        pageCount:6,
	        current:1,
	        backFn:function(p){
	            console.log(p);
	        }
	    });
		$('#create').click(function(){
			$('#addForm').attr('action', '/admin/product/create.json').submit();
		});
		$("#quxiao").click(function(){
			$(".close").click();
		});
		$('#cancel').click(function(){
			$(".close").click();
		});
		$('#ok').click(function(){
			var id=$('.change_product_id').html();
			$("#editForm").attr('action', '/admin/product/'+id+'.json').submit();
		});
		$('#pagination li').click(function(){
			alert(11);
		})
	})
</script>
</html>
